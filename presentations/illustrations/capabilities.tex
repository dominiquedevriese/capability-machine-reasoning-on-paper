\begin{frame}
  \frametitle{Stack and return capabilities}
  \begin{tikzpicture}[scale=.5, every node={scale=.5}]
    % recurrent parts
    \stdstackstart

    % first step: capabilities
    \begin{onlyenv}<+-+(4)>
      \draw[fill=white] (0,2.5) rectangle (6,5.5) node[pos=.5] {\footnotesize current stack frame};
    \end{onlyenv}
    \begin{onlyenv}<.-.(3)>
      \draw [decorate,decoration={brace,amplitude=10pt,mirror,raise=4pt},yshift=0pt]
      (6.5,2.5) -- (6.5,16) node[draw=black] (sp1) [black,midway,xshift=0.8cm] {};
      \draw node[right=0cm of sp1] { stack capability };
    \end{onlyenv}
    \begin{onlyenv}<.-.(1)>
      % \draw [decorate,decoration={brace,amplitude=10pt,mirror,raise=4pt},yshift=0pt]
      % (6,0) -- (6,16) node (oldframe1) [black,midway,xshift=0.5cm] {};
      \draw (7.5,4) node[right,fill=gray!50] (rp1l) {return capability data};
    \end{onlyenv}

    % prepare call: store old return capability
    \draw<+-+(3)>[fill=gray!50] (0,6) rectangle node {\scriptsize old return cap code} (6,6.5);
    \begin{onlyenv}<+-+(2)>
      \draw[fill=gray!50] (0,5.5) rectangle node {\scriptsize old return cap data} (6,6);
      % \draw [decorate,decoration={brace,amplitude=10pt,raise=4pt},yshift=0pt]
      % (0,0) -- (0,16) node (oldframe1) [black,midway,xshift=-0.5cm] {};
      % \draw (0,5.75) edge[->,out=180,in=225] (oldframe1);
    \end{onlyenv}
    \begin{onlyenv}<+->
      \draw [decorate,decoration={brace,amplitude=10pt,mirror,raise=4pt,aspect=.4},yshift=0pt]
      (6,2.5) -- (6,16) node (callerframe1) [draw=black,pos=.4,xshift=0.8cm] {};
      \draw node[fill=gray!50,right=0cm of callerframe1] (rp1l) {new return capability data};
    \end{onlyenv}
    \begin{onlyenv}<+->
      \draw [decorate,decoration={brace,amplitude=10pt,mirror,raise=4pt},yshift=0pt]
      (6.5,6.5) -- (6.5,16) node[draw=black] (sp1) [black,midway,xshift=0.8cm] {};
      \draw node[right=0cm of sp1] { new stack capability };
    \end{onlyenv}
    
    % call using capabilities
    \begin{onlyenv}<+->
      \draw[fill=gray!50] (0,2.5) rectangle (6,6.5) node[pos=.5] {\footnotesize caller stack frame};
      \draw[fill=white] (0,6.5) rectangle (6,9.5) node[pos=.5] {\footnotesize callee stack frame};
    \end{onlyenv}
  \end{tikzpicture}
\end{frame}

%%% Local Variables:
%%% TeX-master: "presentation-illustrations"
%%% End: